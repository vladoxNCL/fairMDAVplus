\section{Fair-MDAV} 
\label{sec:our-approach}
In this section, we present the Fair-MDAV algorithm, designed to improve fairness while giving some guarantees of user's privacy. 
From now on, we consider that the Protected Attribute (PA) and the label in terms of fairness are also Sensitive Attributes in terms of privacy. That is, neither the PA nor the label should be inferred easily from the other data (QIs).
%As a concrete example, in a gender study of income, neither the gender or the income of an individual should be inferred from the data, to prevent from discrimination and from invasion of privacy.
The algorithm Fair-MDAV (Algorithm \ref{alg:Fair-MDAV}) is based on MDAV (maximum distance to average) algorithm. 
On each iteration Fair-MDAV finds the element that is furthest from the average record, generates a fairlet, removes these elements, and iterates. After obtaining all the fairlets, calculates the center of the fairlet (average record) and replaces all the original records by their corresponding center (Algorithm \ref{alg:microaggregation}). Finally, Fair-MDAV swaps the labels of the records in the unfavored class in each fairlet while the positive ratio for them is less than $\tau$ times the positive ratio for the favored class, see Algorithm \ref{alg:tau}. 

\begin{algorithm}[ht]
\SetKwProg{Fn}{Function}{}{end}
\SetKwFunction{Fairlets}{fairlets}
\SetKwFunction{Centers}{centers}
\SetKwFunction{FairMDAV}{Fair-MDAV}
\Fn{\Fairlets{$df, n_U, n_F$}}{
\While{$|\{x\in df :label(x) = U\}| \geq n_U
\mbox{ and } |\{x\in df :label(x) = F\}| \geq n_F $}
{
  $x_r = argmax\{d(x,\overline{x})\}$
  where $\overline{x} = avg\{x\in df\}$
	
  $U = \{x_U\}$ the $n_U \mbox{ closest records to } x_r
  \mbox{ such that } labels(x_U) = U$

  $F = \{x_F\}$ the $n_F \mbox{ closest records to } x_r
  \mbox{ such that } labels(x_F) = F$

  $g = U\cup F$ (must have $n_U + n_F$ records including $x_r$)

  Remove $g$ from $df$
        
  Add $g$ to $\mathcal{G}$ list of fairlets.    
}
\KwRet $\mathcal{G}$ list of fairlets
}
\Fn{\Centers{$df$, $\mathcal{G}$}}{
\For{$g\in  \mathcal{G}$}
{
  $\overline{x} = avg\{x \in g\}$
  
  $x = \overline{x}$ for $x\in g\subset df$
  (replace record by group centroid)
}
\KwRet $\overline{df}$
}
\caption{Microaggregation operations of Fair-MDAV}
\label{alg:microaggregation}
\end{algorithm}

%\pagebreak

\begin{algorithm}[ht]
\SetKwProg{Fn}{Function}{}{end}
\SetKwFunction{FTau}{tau}

\Fn{\FTau{$df, {\mathcal G}, \tau$}}{
%\KwIn{dataframe, clusters, parameter}
%\KwOut{$\tilde{df}$ dataframe}
\For{$C\in  \mathcal{G}$}{
	$fpr = |\{x \in G : pa(x)=F \mbox{ and } label(x)=1\}|$

	$upr = |\{x \in G : pa(x)=U \mbox{ and } label(x)=1\}|$

	$unfav = \{x \in G : pa(x)=U \mbox{ and } label(x)=0\}$

	\While{$upr < \tau * fpr$ and $|unfav| > 0$}
		{$label(x)=1$ for some $x\in unfav$} 
}
\KwRet $\widetilde{df}$
}
\caption{Tau function for label-swapping}
\label{alg:tau}
\end{algorithm}


The main properties of Fair-MDAV are that it is able to generate fairlets for fair clustering. It provides $t-$closeness regarding the PA by setting the proportion $n_U/n_F$ to approximate the proportion $|U|/|F|$ in the entire set, in the more restrictive case, setting $n_U=|U|$ and $n_F = |F|$. Fair-MDAV also provides $(n_U + n_F)$-anonymity by design and it equalizes the privacy guarantees for both classes of PA with respect to the SA label, this is obtained by improving fairness with the Tau function, as the $upr$ is increased by label-swapping while it is less than $\tau * fpr$.

\begin{algorithm}[ht]
\SetKwProg{Fn}{Function}{}{end}
%\SetKwFunction{Fairlets}{fairlets}
%\SetKwFunction{Centers}{centers}
\SetKwFunction{FairMDAV}{Fair-MDAV}
\SetKwFunction{FTau}{tau}

\Fn{\FairMDAV{$df, n_U, n_F, \tau$}}{

$\mathcal{G} = \Fairlets(df, n_U, n_F)$

$\overline{df}= \Centers (\mathcal{G}, df)$

$\widetilde{df}= \FTau(\overline{df},  \mathcal{G}, \tau)$	

\KwOut{$\widetilde{df}$}
}
\caption{Pseudo code of Fair-MDAV}
\label{alg:Fair-MDAV}
\end{algorithm}


